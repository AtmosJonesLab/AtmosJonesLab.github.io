<!DOCTYPE html>
<html>
<head>
  <title>Google Sheets API Demo</title>
</head>
<body>
    <h2>Sensor Readings</h2>
    <table border="1" id="sensor-table">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Humidity</th>
          <th>Temperature</th>
          <th>Point Dendrometer</th>
          <th>Lidar Dendrometer</th>
          <th>Battery State</th>
          <th>Battery Voltage</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  <script>
    const API_KEY = 'AIzaSyBWq6_OOSDWjRS5j5Oco-TRAFtZRGMnwPA'; // Replace with your actual API key
    const SHEET_ID = '1ik-hGF90uWHn2UCbzIJIQO_qhCTvhT1YTB4KH1C9-xQ'; // Replace with your spreadsheet ID
    const RANGE = 'unsorteddata!A2:C'; // Adjust range as needed

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const rows = data.values;
        console.log('Fetched rows:', rows);

        // Step 1: Group by timestamp
        const groupedData = {};
        rows.forEach(([type, timestamp, value]) => {
          if (!groupedData[timestamp]) {
            groupedData[timestamp] = {};
          }
          groupedData[timestamp][type.toLowerCase()] = value;
        });

        // Step 2: Render HTML Table
        const tbody = document.querySelector('#sensor-table tbody');
        for (const [timestamp, sensors] of Object.entries(groupedData)) {
          const tr = document.createElement('tr');

          const tdTime = document.createElement('td');
          tdTime.textContent = timestamp;
          tr.appendChild(tdTime);

          const columns = [
            'humidity',
            'temperature',
            'point dendrometer',
            'lidar dendrometer',
            'battery state',
            'battery voltage'
          ];

          columns.forEach(col => {
            const td = document.createElement('td');
            td.textContent = sensors[col] || '-';
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  </script>
</body>
</html>